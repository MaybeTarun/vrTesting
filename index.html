<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>360 Video | Language Selector</title>
    <link rel="icon" type="image/png" href="favicon.png" />

    <!-- A-Frame + HLS.js -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <!-- External Styles -->
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <!-- Language selection overlay -->
    <div id="language-selector">
      <h1>Select Language</h1>
      <div class="button-row">
        <button class="lang-btn" id="hindiBtn">Hindi</button>
        <button class="lang-btn" id="malayalamBtn">Malayalam</button>
      </div>
    </div>

    <!-- Loader -->
    <div id="loader">
      <div class="spinner"></div>
      <p>Loading video, please wait...</p>
    </div>

    <!-- A-Frame Scene -->
    <a-scene vr-mode-ui="enabled: true">
      <a-videosphere src="#vid360" rotation="0 180 0"></a-videosphere>
      <video
        id="vid360"
        autoplay
        loop
        playsinline
        webkit-playsinline
        crossorigin="anonymous"
        muted
      ></video>
    </a-scene>

    <script>
      const video = document.getElementById('vid360');
      const selector = document.getElementById('language-selector');
      const loader = document.getElementById('loader');

      const sources = {
        hindi: 'https://stream.mux.com/e4jHaTTK8vsZMxpdHwTS0099ReM01NuvAHobk4t0102ijPM.m3u8',
        malayalam: 'https://cdn.bitmovin.com/content/assets/playhouse-vr/m3u8s/105560.m3u8',
      };

      function loadVideo(hlsSrc) {
        loader.style.display = 'flex';

        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(hlsSrc);
          hls.attachMedia(video);

          hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
          hls.on(Hls.Events.LEVEL_LOADED, () => (loader.style.display = 'none'));
          video.addEventListener('playing', () => (loader.style.display = 'none'));
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = hlsSrc;
          video.addEventListener('loadedmetadata', function () {
            loader.style.display = 'none';
            video.play();
          });
        }
      }

      document.getElementById('hindiBtn').addEventListener('click', () => {
        selector.classList.add('fade-out');
        setTimeout(() => (selector.style.display = 'none'), 500);
        loadVideo(sources.hindi);
      });

      document.getElementById('malayalamBtn').addEventListener('click', () => {
        selector.classList.add('fade-out');
        setTimeout(() => (selector.style.display = 'none'), 500);
        loadVideo(sources.malayalam);
      });
    </script>
  </body>
</html>
